"use strict";window.EC5=window.EC5||{},window.EC5.projectApps=window.EC5.projectApps||{},function(e){e.currentClientId="",e.getApps=function(){$.ajax({url:"",type:"GET",dataType:"json",data:{}}).done(function(e){$(".project-apps-list").html(e)}).fail(window.EC5.showError)},e.post=function(t,a,o){$.ajax({url:t,type:"POST",dataType:"json",data:a}).done(function(){o&&o(),e.getApps()}).fail(window.EC5.showError)}}(window.EC5.projectApps),$(document).ready(function(){var e=$(".project-apps");e.on("click",".pagination a",function(e){e.preventDefault(),window.EC5.projectApps.getApps()});var t=$("#ec5-form-project-apps");t.on("submit",function(e){e.preventDefault();var t=$(this).serialize(),a=$(this).attr("action");window.EC5.overlay.fadeIn(),window.EC5.projectApps.post(a,t,function(){$("#create-app").prop("disabled",!0),$("#modal-create-app").modal("hide"),window.EC5.toast.showSuccess("New App added."),setTimeout(function(){window.EC5.overlay.fadeOut()},500)})});var a=$(".project-apps-list");a.on("click","#delete-app",function(e){e.preventDefault(),$("#ec5-form-project-app-revoke").addClass("hidden"),$("#ec5-form-project-app-delete").removeClass("hidden"),window.EC5.projectApps.currentClientId=$(this).data("clientId")}),a.on("click","#revoke-app",function(e){e.preventDefault(),$("#ec5-form-project-app-delete").addClass("hidden"),$("#ec5-form-project-app-revoke").removeClass("hidden"),window.EC5.projectApps.currentClientId=$(this).data("clientId")});var o=$("#ec5-form-project-app-delete");o.on("submit",function(e){e.preventDefault();var t={client_id:window.EC5.projectApps.currentClientId},a=$(this).attr("action");window.EC5.overlay.fadeIn(),window.EC5.projectApps.post(a,t,function(){$("#create-app").prop("disabled",!1),$("#modal-app-delete").modal("hide"),window.EC5.toast.showSuccess("App deleted."),setTimeout(function(){window.EC5.overlay.fadeOut()},500)})});var n=$("#ec5-form-project-app-revoke");n.on("submit",function(e){e.preventDefault();var t={client_id:window.EC5.projectApps.currentClientId},a=$(this).attr("action");window.EC5.overlay.fadeIn(),window.EC5.projectApps.post(a,t,function(){$("#modal-app-delete").modal("hide"),window.EC5.toast.showSuccess("Access Token revoked."),setTimeout(function(){window.EC5.overlay.fadeOut()},500)})})}),window.EC5=window.EC5||{},window.EC5.projectCreate=window.EC5.projectCreate||{},function(e){e.doesProjectExist=function(e){var t=$(".page-create-project").find("#project-name-form-group-create");$.when($.get(e)).done(function(e){console.log(e.data),$("#project-loader").addClass("hidden"),e.data.exists?window.EC5.projectCreate.toggleGroupValidation(t,!1,"Project already exists"):window.EC5.projectCreate.toggleGroupValidation(t,!0)}).fail(function(){t.addClass("has-error")}).always(function(){$("#project-loader").addClass("hidden")})},e.toggleGroupValidation=function(e,t,a){t?(e.removeClass("has-error"),e.find(".form-control-feedback").not("#project-loader").addClass("hidden"),e.find(".text-danger").addClass("hidden"),e.find(".text-hint").removeClass("hidden")):(e.addClass("has-error"),e.find(".form-control-feedback").not("#project-loader").removeClass("hidden"),e.find(".text-danger").removeClass("hidden").text(a),e.find(".text-hint").addClass("hidden"))}}(window.EC5.projectCreate),$(document).ready(function(){if(0!==$(".page-create-project").length){var e=$("#project-loader");$(".page-create-project #project-name-create").keyup(function(t){var a,o=$(".page-create-project #project-name-form-group-create"),n=$(this),r=n.val(),i=/^[a-zA-Z0-9_ ]*$/;if(i.test(r)||""===r){if(window.EC5.projectCreate.toggleGroupValidation(o,!0),r.length>=3){var s=window.EC5.SITE_URL+"/api/internal/exists/"+r;e.removeClass("hidden"),clearTimeout(a),a=setTimeout(function(){window.EC5.projectCreate.doesProjectExist(s)},500)}}else e.addClass("hidden"),window.EC5.projectCreate.toggleGroupValidation(o,!1,"Please remove invalid chars")}),$(".page-create-project #form-name").keyup(function(e){var t=/^[\w\-\s]+$/,a=$(this),o=a.val(),n=$("#form-name-form-group");t.test(o)||""===o?window.EC5.projectCreate.toggleGroupValidation(n,!0):window.EC5.projectCreate.toggleGroupValidation(n,!1,"Please remove invalid chars")}),$(".page-create-project #small-description-form-group > input").keyup(function(e){var t=$("#small-description-form-group"),a=$(this),o=a.val();o.length>=15?window.EC5.projectCreate.toggleGroupValidation(t,!0):window.EC5.projectCreate.toggleGroupValidation(t,!1,"Must be at least 15 chars long")})}}),$(document).ready(function(){function e(e){e.returnValue="ciao"}function t(o,n,r){$.when(window.EC5.projectUtils.postRequest(o,n)).done(function(i){p+=u>c?c:u,a(p,u,l),$.get(window.EC5.SITE_URL+"/api/internal/counters/entries/"+r,function(a){try{a.data.counters.total>0?(u=a.data.counters.total,t(o,n,r)):(window.removeEventListener("beforeunload",e),window.location.href=d,window.EC5.toast.showSuccess("All Entries Deleted."))}catch(i){window.EC5.projectUtils.showErrors(i),s.modal("hide")}}).fail(function(e){window.EC5.projectUtils.showErrors(e),s.modal("hide")})}).fail(function(e){window.EC5.projectUtils.showErrors(e),s.modal("hide")})}function a(e,t,a){if(0===t)return i.find(".counter-percentage").text("100%"),void i.find(".counter-deleted").text(a);var o=(e/a*100).toFixed(2),n=(100*(1-e/a)).toFixed(2),r=$(".progress-bar__modal-deletion");r.attr("aria-valuenow",n),r.css("width",n+"%"),i.find(".counter-percentage").text(o+"%"),i.find(".counter-deleted").text(e),i.find(".counter-total").text(a)}var o=$(".page-entries-deletion");if(o.length>0){var n=o.find(".project-name").text(),r=$(".delete-entries-wrapper"),i=$(".counter-wrapper"),s=$("#modal-deletion"),d=$(".btn-cancel-deletion").attr("href"),c=o.data("chunk-size");r.on("click",".btn-delete-entries",function(a){n.trim()!==$("#project-name").val().trim()&&a.preventDefault();var o=window.EC5.projectUtils.slugify(n.trim()),r=window.EC5.SITE_URL+"/api/internal/deletion/entries/"+o,i={data:{"project-name":n.trim()}};s.modal({backdrop:"static",keyboard:!1},"show"),window.addEventListener("beforeunload",e),t(r,i,o)}),r.on("keyup","#project-name",function(e){e.preventDefault(),n.replace(/\s+/g," ")===$(this).val()?$(".btn-delete-entries").prop("disabled",!1):$(".btn-delete-entries").prop("disabled",!0)});var p=0,l=parseInt(r.data("total-entries")),u=l;i.find(".counter-total").text(u)}}),$(document).ready(function(){if($(".page-project-delete").length>0){var e=$("h3[data-project-name]").attr("data-project-name"),t=$(".delete-project"),a=$("#modal-deletion");t.submit(function(t){e.replace(/\s+/g," ")!==$("#project-name").val()&&t.preventDefault(),a.modal({backdrop:"static",keyboard:!1},"show")}),t.on("keyup","#project-name",function(t){t.preventDefault(),e.replace(/\s+/g," ")===$(this).val()?$(".submit-delete").prop("disabled",!1):$(".submit-delete").prop("disabled",!0)})}}),window.EC5=window.EC5||{},window.EC5.projectDetails=window.EC5.projectDetails||{},function(e){e.statusPairs={trashed:["restore","delete"],locked:["unlock"],active:["trashed","locked"]},e.currentSettingsValue=function(e){return window.EC5.projectDetails.parameters[e]||""},e.updateSettings=function(t){var a=e.currentSettingsValue(t),o=$(".settings-"+t);if("status"===t){var n=e.statusPairs[a]?e.statusPairs[a]:[];o.each(function(e,t){$(t).data("value")===a?$(this).addClass("btn-action"):$(this).removeClass("btn-action"),n.indexOf($(t).data("value"))!==-1||$(t).data("value")===a?$(this).removeClass("ec5-hide-block"):$(this).addClass("ec5-hide-block")})}o.each(function(e,t){$(t).data("value")===a?$(this).addClass("btn-action"):$(this).removeClass("btn-action")})},e.update=function(t,a){var o=window.EC5.SITE_URL+"/myprojects/"+window.EC5.projectDetails.parameters.slug+"/settings/"+t,n={};n[t]=a,$.when(window.EC5.projectUtils.postRequest(o,n)).done(function(a){try{$.each(a.data,function(e,t){window.EC5.projectDetails.parameters[e]=t}),e.updateSettings(t),window.EC5.toast.showSuccess("Settings updated.")}catch(o){window.EC5.projectUtils.showErrors(o)}}).fail(function(e){window.EC5.overlay.fadeOut(),window.EC5.projectUtils.showErrors(e)}).always(function(){window.EC5.overlay.fadeOut()})}}(window.EC5.projectDetails),$(document).ready(function(){if(0===$(".page-project-details").length)return!1;$('[data-toggle="tooltip"]').tooltip();var e=$(".js-project-details");if($(document).on("change",":file",function(){var e=$(this),t=e.get(0).files?e.get(0).files.length:1,a=e.val().replace(/\\/g,"/").replace(/.*\//,"");e.trigger("fileselect",[t,a])}),$(":file").on("fileselect",function(e,t,a){var o=$(this).parents(".input-group").find(":text"),n=t>1?t+" files selected":a;o.length&&o.val("    "+n)}),window.EC5.projectDetails.parameters={status:e.attr("data-js-status"),access:e.attr("data-js-access"),visibility:e.attr("data-js-visibility"),logo_url:e.attr("data-js-logo_url"),category:e.attr("data-js-category"),slug:e.attr("data-js-slug"),app_link_visibility:e.attr("data-js-app_link_visibility")},$(".deeplink-btn-panel").length>0){var t=$("#qrcode");new window.QRCode("qrcode",{text:t.data("url"),width:1024,height:1024,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H});$("#qrcode-download").on("click",function(){var e=t.find("img");$(this).attr("href",e.attr("src"))})}$(".btn-settings-submit").on("click",function(){var e=$(this),t=e.attr("data-setting-type"),a=e.attr("data-value");a!==window.EC5.projectDetails.currentSettingsValue(t)&&(window.EC5.overlay.fadeIn(),window.EC5.projectDetails.update(t,a))}),$(["access","status","visibility","app_link_visibility"]).each(function(e,t){window.EC5.projectDetails.updateSettings(t)}),$("#project-category").on("change",function(e){var t="category",a=$(this).val();a!==window.EC5.projectDetails.currentSettingsValue(t)&&(window.EC5.overlay.fadeIn(),window.EC5.projectDetails.update(t,a))}),$(".project-details__edit").on("click",function(){var e=$(this).parents(".panel");switch(window.EC5.overlay.fadeIn(),e.hide(),e.attr("id")){case"details-view":$("#details-edit").fadeIn(function(){window.EC5.overlay.fadeOut()});break;case"details-edit":$("#details-view").fadeIn(function(){window.EC5.overlay.fadeOut()})}}),$(".project-homepage-url .copy-btn").on("click",function(){var e=$(this);console.log(e.parent().find("a").text()),navigator.clipboard.writeText(e.parent().find("a").text()).then(function(){e.tooltip("show"),window.setTimeout(function(){e.tooltip("hide")},1500)},function(){})}),$(".deeplink-copy-btn").on("click",function(){var e=$(this),t=e.data("url");console.log(t),navigator.clipboard.writeText(t).then(function(){e.find("i").tooltip("show"),window.setTimeout(function(){e.find("i").tooltip("hide")},1500)},function(){})})}),$(document).ready(function(){if($(".page-project-home").length>0){var e=$("#qrcode");new window.QRCode("qrcode",{text:e.data("url"),width:200,height:200,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H})}}),$(document).ready(function(){if($(".page-project-leave").length>0){var e=$("h3[data-project-name]").attr("data-project-name"),t=$(".leave-project"),a=$("#modal-leave");t.submit(function(t){e.replace(/\s+/g," ")!==$("#project-name").val()&&t.preventDefault(),a.modal({backdrop:"static",keyboard:!1},"show")}),t.on("keyup","#project-name",function(t){t.preventDefault(),e.replace(/\s+/g," ")===$(this).val()?$(".submit-leave").prop("disabled",!1):$(".submit-leave").prop("disabled",!0)})}}),$(document).ready(function(){var e=$(".manage-entries-limits__table"),t=$(".page-manage-entries #limits-form"),a=$(".page-manage-entries .limits-form__update-btn"),o=$(".page-manage-entries .bulk-upload-btns"),n=o.data("project-slug"),r=window.EC5.SITE_URL+"/api/internal/can-bulk-upload/"+n;e.on("change","td input:checkbox",function(){var e=$(this).parents("td").next().find("input.input__limit-to");this.checked?e.prop("disabled",!1):(e.val(""),e.prop("disabled",!0))}),a.on("click",function(){window.EC5.toast.clear(),window.EC5.overlay.fadeIn(),t.find(".input__set-limit").each(function(){var e=$(this),t=e.parents("td").next().find("input.input__limit-to"),a=t.parent(),o=a.find(".form-control-feedback");o.addClass("hidden"),a.removeClass("has-error has-feedback")});var e=!0;t.find(".input__set-limit:checked").each(function(){var t=$(this),a=t.parents("td").next().find("input.input__limit-to"),o=a.parent(),n=o.find(".form-control-feedback");""===a.val()&&(o.addClass("has-error has-feedback"),n.removeClass("hidden"),e=!1)}),e?t.submit():(window.EC5.overlay.fadeOut(),window.EC5.toast.showError("Required fields missing!"))}),t.on("submit",function(e){e.preventDefault(),$.ajax({url:"",type:"POST",dataType:"json",data:$(this).serializeArray()}).done(function(){window.EC5.toast.showSuccess("Updated.")}).fail(function(e){if(e.responseJSON&&e.responseJSON.errors&&e.responseJSON.errors.length>0){var t;for(t=0;t<e.responseJSON.errors.length;t++)window.EC5.toast.showError(e.responseJSON.errors[t].title)}}).always(function(){window.EC5.overlay.fadeOut()})}),o.on("click",".btn",function(e){var t=$(this);window.EC5.overlay.fadeIn(),window.EC5.projectUtils.postRequest(r,{can_bulk_upload:$(this).data("bulk-upload")}).done(function(){o.find(".btn-action").removeClass("btn-action"),t.addClass("btn-action"),window.EC5.overlay.fadeOut(),window.EC5.toast.showSuccess("Settings updated.")}).fail(function(e){if(e.responseJSON.errors&&e.responseJSON.errors.length>0)for(var t=0;t<e.responseJSON.errors.length;t++)window.EC5.toast.showError(e.responseJSON.errors[t].title);window.EC5.overlay.fadeOut()})})}),$(document).ready(function(){if(0!==$(".page-manage-users").length){var e,t=$(".manage-project-users"),a="#creator",o=window.EC5.project_users.config;window.EC5.overlay.fadeIn(),$('a[data-toggle="tab"]').on("show.bs.tab",function(e){window.EC5.overlay.fadeIn();var t=$(e.target).attr("href");a="page-"+t.substring(1),$(".manage-project-users__"+a).html(""),$(".user-search-heading").hide(),$.when(window.EC5.project_users.getProjectUsers(a,1)).then(function(e){$(".manage-project-users__"+a).hide().html(e).fadeIn(o.consts.ANIMATION_FAST)},function(e){e.responseJSON?window.EC5.toast.showError(e.responseJSON.errors[0].title):window.EC5.toast.showError(e)}).always(function(){window.EC5.overlay.fadeOut()})}),$.when(window.EC5.project_users.getProjectUsers("page-creator").then(function(e){$(".manage-project-users__"+a).remove().html(e),window.EC5.overlay.fadeOut()},function(e){window.EC5.overlay.fadeOut()})),$(".page-manage-users .tab-content .panel-body").off().on("click",".manage-project-users__switch-role",function(){var e=$(this).data("project-slug"),t=$(this).data("user-role"),a=$(this).data("user-email"),n=$("#ec5SwitchUserRole");n.find(".user-email strong").text(a);var r=$.map(o.consts.ROLES,function(e){return e});$(r).each(function(e,t){n.find(".role-"+t).show()}),n.find(".role-"+t).hide(),n.find(".switch-role-confirm").attr("disabled",!0),n.find("input:radio").prop("checked",!1),n.modal("show"),n.on("shown.bs.modal",function(o){var r=null;n.find(".users__pick-role .radio label").off().on("click",function(){r=n.find(".users__pick-role").find(".radio input:checked").val(),n.find(".switch-role-confirm").attr("disabled",!1)}),n.find(".switch-role-confirm").off().on("click",function(){return null!==r&&(!(!e||!a)&&(window.EC5.overlay.fadeIn(),void $.when(window.EC5.project_users.switchUserRole(e,a,t,r)).done(function(e){var a="page-"+t;$.when(window.EC5.project_users.getProjectUsers(a,1).then(function(t){$(".manage-project-users__"+a).html(t),n.modal("hide"),window.EC5.toast.showSuccess(e.data.message),window.EC5.overlay.fadeOut()},function(e){window.EC5.overlay.fadeOut(),e.responseJSON?window.EC5.toast.showError(e.responseJSON.errors[0].title):window.EC5.toast.showError(e),n.modal("hide")}))}).fail(function(e){console.log(e),window.EC5.overlay.fadeOut(),e.responseJSON?window.EC5.toast.showError(e.responseJSON.errors[0].title):window.EC5.toast.showError(e),n.modal("hide")})))})})}),t.on("click",".pagination a",function(e){e.preventDefault(),window.EC5.overlay.fadeIn();var t=$(this).closest(".manage-project-users"),a=t.data("page-name"),o=t.find(".manage-project-users__user-search").val();$.when(window.EC5.project_users.getProjectUsers(a,$(this).attr("href").split("=")[1],o).then(function(e){$(".manage-project-users__"+a).html(e),window.EC5.overlay.fadeOut()},function(){window.EC5.overlay.fadeOut()}))}),t.on("keyup",".manage-project-users__user-search",function(t){var a=this.value;if(a.length>=0||13===t.keyCode){window.EC5.overlay.fadeIn();var o=$(this).closest(".manage-project-users"),n=o.data("page-name"),r=200;clearTimeout(e),e=setTimeout(function(){$.when(window.EC5.project_users.getProjectUsers(n,1,a).then(function(e){$(".manage-project-users__"+n).html(e),window.EC5.overlay.fadeOut()},function(){window.EC5.overlay.fadeOut()}))},r)}}),t.on("click",".manage-project-users__reset",function(e){window.EC5.overlay.fadeIn(),e.preventDefault();var t=$(this).closest(".manage-project-users"),a=t.data("page-name");$(".manage-project-users__user-search").val(""),$.when(window.EC5.project_users.getProjectUsers(a,1).then(function(e){$(".manage-project-users__"+a).html(e),window.EC5.overlay.fadeOut()},function(){window.EC5.overlay.fadeOut()}))}),t.on("submit",".manage-project-users__table__remove-form",function(e){e.preventDefault();var t=$(this).serializeArray(),a=$(this).attr("action"),o=$(this).closest(".manage-project-users"),n=o.data("page-name"),r=o.find(".pagination .active span").html(),i=o.find(".manage-project-users__user-search").val();window.EC5.project_users.removeUserProjectRole(a,t,n,r,i)}),$(".manage-project-users__existing-user-add-form").on("submit",function(e){e.preventDefault();var t=$(this).serializeArray(),a=$(this).attr("action"),o="page-creator";t.forEach(function(e){if("role"===e.name)return o=e.value?"page-"+e.value:"page-creator",!1}),window.EC5.project_users.addUserProjectRole(a,t,o,function(){$("#ec5ModalExistingUser").find("input[type=email]").val(""),$("#ec5ModalExistingUser").modal("hide")})}),$(".manage-project-users__new-user-add-form").on("submit",function(e){e.preventDefault();var t=$(this).serializeArray(),a=$(".manage-project-users__existing-user-add-form").serializeArray(),o=t.concat(a),n=$(this).attr("action"),r=o[2]&&o[2].value?"page-"+o[2].value:"page-creator";window.EC5.project_users.addUserProjectRole(n,o,r,function(){$("#ec5ModalExistingUser").find("input[type=email]").val(""),$("#ec5ModalExistingUser").modal("hide"),$("#ec5ModalNewUser").modal("hide")})}),$(".manage-user-more__import-users").off().on("click",function(){var e=$(this);if(!window.EC5.project_users.isOpeningFileBrowser){var t=e.find(".manage-user-more__import-users__input-file");window.EC5.project_users.isOpeningFileBrowser=!0,t.off("change").on("change",function(){window.EC5.project_users.pickCSVFile(this.files),$(this).val(null)}),e.find(".manage-user-more__import-users__input-file").trigger("click")}window.setTimeout(function(){window.EC5.project_users.isOpeningFileBrowser=!1},3e3)}),$(".manage-user-more__export-users").off().on("click",function(){var e=$(this).find("a").data("project-slug");window.EC5.overlay.fadeIn(),$.when(window.EC5.project_users.exportUsersToCSV(e)).then(function(){window.EC5.overlay.fadeOut()},function(e){e.responseJSON?window.EC5.toast.showError(e.responseJSON.errors[0].title):window.EC5.toast.showError(e),window.EC5.overlay.fadeOut()})}),$(".manage-project-users__delete-by-role").off().on("click",function(){var e=$(this).data("project-slug"),t=$(this).data("role");window.EC5.overlay.fadeIn(),$.when(window.EC5.project_users.removeUsersByRole(e,t)).then(function(e){window.EC5.toast.showSuccess(e.data.message),$.when(window.EC5.project_users.getProjectUsers(a,1).then(function(e){$(".manage-project-users__"+a).html(e),window.EC5.overlay.fadeOut()},function(){window.EC5.overlay.fadeOut()}))},function(e){window.EC5.overlay.fadeOut(),e.responseJSON?window.EC5.toast.showError(e.responseJSON.errors[0].title):window.EC5.toast.showError(e)})})}}),window.EC5=window.EC5||{},$(document).ready(function(){var e=4,t=$(".page-mapping-data"),a=t.data("url");0!==t.length&&($(".form-list-selection").on("click","li",function(){var e=$(this),t=$(e).data("form-ref"),a=$(".map-data__tabs li.active").data("map-index"),o=$("#map-data-tabcontent-"+a+" .panel-body");e.parents(".form-list-selection").find(".dropdown-toggle .form-list-selection__form-name").text(e.text()),o.find(".table-responsive").fadeOut().addClass("hidden"),o.find('[data-form-ref="'+t+'"]').hide().removeClass("hidden").fadeIn()}),$(".map-data--actions__btns").on("click",'[data-toggle="push"]',function(){var e=$(this),t=e.data("action"),o=$(".map-data__tabs li.active"),n=$(".map-data__tabs li").not(".active").not(".map-data__tabs__add-form"),r=o.data("map-index"),i=o.data("map-name");switch(console.log(t),t){case"make-default":window.EC5.mapping.makeDefault(a,t,r,i,o,n);break;case"update":window.EC5.mapping.update(a,t,r,i)}}),$("#modal__mapping-data").on("show.bs.modal",function(t){var o=$(t.relatedTarget),n=o.data("action"),r=$(this),i=o.data("trans"),s=r.find(".map-data__modal__save-btn"),d=$(".map-data__tabs li.active"),c=!d.find(".map-data__default-pin").hasClass("invisible"),p=d.data("map-index"),l=d.data("map-name"),u=$(".page-mapping-data .tab-content");switch(r.find(".modal-title").text(i),n){case"delete":window.EC5.mapping["delete"](a,n,p,l,d,r,s,c,u);break;case"rename":window.EC5.mapping.rename(a,n,p,l,d,r,s);break;case"add-mapping":window.EC5.mapping.addMapping(a,r,s,e,u,u)}}))}),window.EC5=window.EC5||{},window.EC5.projectUtils=window.EC5.projectUtils||{},function(e){e.postRequest=function(e,t){return $.ajax({url:e,contentType:"application/vnd.api+json",data:JSON.stringify(t),dataType:"json",method:"POST",crossDomain:!0})},e.showErrors=function(e){var t="";e.responseJSON?$(e.responseJSON.errors).each(function(e,a){t+=a.title+"<br/>"}):t+="Unknown error<br/>",window.EC5.toast.showError(t)},e.slugify=function(e){return e.toLowerCase().replace(/\s+/g,"-")}}(window.EC5.projectUtils),window.EC5=window.EC5||{},window.EC5.mapping=window.EC5.mapping||{},function(e){e.addMapping=function(e,t,a,o,n){t.find(".map-data__modal__mapping-name").show(),t.find(".map-data__modal-delete-warning").addClass("hidden"),t.find("map-data__modal__name-rules").removeClass("hidden"),t.find(".map-data__modal__mapping-name").val(""),a.off().on("click",function(){window.EC5.toast.clear();var a=t.find(".map-data__modal__mapping-name").val();window.EC5.projectUtils.postRequest(e,{name:a,is_default:!1}).done(function(e){console.log(e),window.EC5.toast.showSuccess(a+" mapping added");var r=e.data.map_index,i='<li role="presentation" data-map-index="'+r+'" data-map-name="'+a+'">';i+=' <a href="#map-data-tabcontent-'+r+'" role="tab" data-toggle="tab">',i+='<span class="map-data__map-name">'+a+"&nbsp;</span>",i+='<i class="fa fa-thumb-tack invisible" aria-hidden="true"></i>',i+="</a>",i+="</li>",$(".map-data__tabs li").not(".map-data__tabs__add-form").last().after(i),$.isArray(e.data.mapping)?e.data.mapping.length===o&&$(".map-data__tabs li.map-data__tabs__add-form").addClass("hidden"):Object.keys(e.data.mapping).length===o&&$(".map-data__tabs li.map-data__tabs__add-form").addClass("hidden");var s=n.find("#map-data-tabcontent-0").clone(!0,!0);s.attr("id","map-data-tabcontent-"+r),s.attr("data-map-index",r),s.attr("data-map-name",a),s.find("[data-map-index]").each(function(e,t){$(t).attr("data-map-index",r)}),s.find(".map-data--actions__btns .btn").each(function(e,t){$(t).prop("disabled",!1)}),s.find(".table-responsive").each(function(e,t){var a=$(t).find("tr td input");a.prop("disabled",!1).prop("readonly",!1)}),n.append(s),$(".map-data__tabs li.active").removeClass("active"),$('.page-mapping-data .tab-content .tab-pane[data-map-index="0"]').removeClass("active in"),$('.map-data__tabs li[data-map-index="'+r+'"]').addClass("active"),$('.map-data__tabs li[data-map-index="'+r+'"] a').tab("show"),window.setTimeout(function(){t.modal("hide")},250)}).fail(function(e){console.log(e),window.EC5.projectUtils.showErrors(e)})})}}(window.EC5.mapping),window.EC5=window.EC5||{},window.EC5.mapping=window.EC5.mapping||{},function(e){e["delete"]=function(e,t,a,o,n,r,i,s,d){r.find(".map-data__modal__mapping-name").hide(),r.find(".map-data__modal-delete-warning").removeClass("hidden"),r.find("map-data__modal__name-rules").addClass("hidden"),i.off().on("click",function(){window.EC5.toast.clear(),window.EC5.projectUtils.postRequest(e+"/delete",{map_index:a}).done(function(e){var t=$(".map-data__tabs");window.EC5.toast.showSuccess(o+" deleted"),n.remove(),d.find("#map-data-tabcontent-"+a).remove(),t.find('a[href="#map-data-tabcontent-0"]').tab("show"),s&&t.find(".map-data__default-pin").first().removeClass("invisible"),$(".map-data__tabs li.map-data__tabs__add-form").removeClass("hidden"),r.modal("hide")}).fail(function(e){console.log(e),window.EC5.projectUtils.showErrors(e)})})}}(window.EC5.mapping),window.EC5=window.EC5||{},window.EC5.mapping=window.EC5.mapping||{},function(e){e.getDefaultMapIndex=function(){var e=0,t=$(".map-data__tabs li");return t.each(function(t,a){var o=$(a).attr("data-map-index");if(!$(a).find(".map-data__default-pin").hasClass("invisible"))return e=o,!1}),parseInt(e,10)}}(window.EC5.mapping),window.EC5=window.EC5||{},window.EC5.mapping=window.EC5.mapping||{},function(e){e.makeDefault=function(e,t,a,o,n,r){window.EC5.toast.clear(),window.EC5.projectUtils.postRequest(e+"/update",{action:t,map_index:a}).done(function(e){console.log(JSON.stringify(e)),window.EC5.toast.showSuccess(o+" set as default"),n.find(".map-data__default-pin").removeClass("invisible"),r.each(function(e,t){$(t).find(".map-data__default-pin").addClass("invisible")})}).fail(function(e){window.EC5.projectUtils.showErrors(e)})}}(window.EC5.mapping),window.EC5=window.EC5||{},window.EC5.mapping=window.EC5.mapping||{},function(e){e.rename=function(e,t,a,o,n,r,i){r.find(".map-data__modal__mapping-name").show(),r.find(".map-data__modal-delete-warning").addClass("hidden"),r.find("map-data__modal__name-rules").removeClass("hidden"),r.find(".map-data__modal__mapping-name").val(o),i.off().on("click",function(){window.EC5.toast.clear();var o=r.find(".map-data__modal__mapping-name").val();window.EC5.projectUtils.postRequest(e+"/update",{action:t,map_index:a,name:o}).done(function(e){n.attr("data-map-name",o),n.find(".map-data__map-name").text(o),r.modal("hide"),window.EC5.toast.showSuccess(o+" renamed")}).fail(function(e){console.log(e),window.EC5.projectUtils.showErrors(e)})})}}(window.EC5.mapping),window.EC5=window.EC5||{},window.EC5.mapping=window.EC5.mapping||{},function(e){e.update=function(e,t,a,o){window.EC5.toast.clear(),window.EC5.overlay.fadeIn();var n={},r=$('.page-mapping-data .tab-content .tab-pane[data-map-index="'+a+'"]'),i=!0,s=null,d={},c=/^[a-zA-Z0-9_]{1,20}$/,p=/^((?![<>]).){1,150}$/,l=r.find(".panel-body .table-responsive");r.find("input").parent().removeClass("has-error"),n[a]={},n[a].name=o,n[a].forms={},n[a].map_index=a,n[a].is_default=window.EC5.mapping.getDefaultMapIndex()===a,l.each(function(e,t){var o=n[a],r=$(t).attr("data-form-ref"),l=$(t).find("tbody tr"),u=0;for(d[r]=[],o.forms[r]={};u<l.length;){var w=o.forms[r],f=$(l[u]).attr("data-input-ref"),m=$(l[u]).find(".mapping-data__map-to input"),h=m.val(),E=$(l[u]).find(".mapping-data__hide-checkbox input").is(":checked");if(h=void 0===h?void 0:h.trim(),f){switch(w[f]={},w[f].possible_answers={},w[f].branch={},w[f].group={},w[f].map_to=h,w[f].hide=E,void 0!==h&&d[r].push(h),h.match(c)||(i=!1,$(l[u]).find(".mapping-data__map-to input").parent().addClass("has-error")),$(l[u]).attr("data-input-type")){case"branch":var C=$(l[u]).nextUntil("[data-top-level-input]","[data-is-branch-input]");w[f].branch={},$(C).each(function(e,t){var a,o=$(t).attr("data-input-ref"),n=$(t).find(".mapping-data__map-to input"),s=n.val(),l=$(t).find(".mapping-data__hide-checkbox input").is(":checked");if(s=void 0===s?void 0:s.trim(),o){if(w[f].branch[o]={},a=w[f].branch[o],a.possible_answers={},a.branch={},a.group={},a.map_to=s,a.hide=l,void 0!==s&&d[r].push(s),s.match(c)||(i=!1,$(t).find(".mapping-data__map-to input").parent().addClass("has-error")),"group"===$(t).attr("data-input-type")){var m=$(t).nextUntil("[data-is-branch-input], [data-top-level-input]","[data-is-group-input]");a.group={},$(m).each(function(e,t){var n=$(t).attr("data-input-ref"),s=$(t).find(".mapping-data__map-to input"),l=s.val(),u=$(t).find(".mapping-data__hide-checkbox input").is(":checked");l=void 0===l?void 0:l.trim(),n?(a.group[n]={},a.group[n].possible_answers={},a.group[n].branch={},a.group[n].group={},a.group[n].map_to=l,a.group[n].hide=u,void 0!==l&&d[r].push(l),l.match(c)||(i=!1,$(t).find(".mapping-data__map-to input").parent().addClass("has-error"))):$(t).find(".mapping-data__possible_answer__map-to input").each(function(e,a){var n=$(t).prev().attr("data-input-ref"),r=w[f].branch[o].group[n],s=$(a).attr("data-answer-ref"),d=$(a).val();d=void 0===d?void 0:d.trim(),d.match(p)||(i=!1,$(a).parent().addClass("has-error")),r.possible_answers[s]={},r.possible_answers[s].map_to=d})}),u+=m.length}}else $(t).find(".mapping-data__possible_answer__map-to input").each(function(e,a){var o=$(t).prev().attr("data-input-ref"),n=w[f].branch[o],r=$(a).attr("data-answer-ref"),s=$(a).val();s=void 0===s?void 0:s.trim(),s.match(p)||(i=!1,$(a).parent().addClass("has-error")),n.possible_answers[r]={},n.possible_answers[r].map_to=s})}),u+=C.length;break;case"group":var _=$(l[u]).nextUntil("[data-top-level-input]","[data-is-group-input]");$(_).each(function(e,t){var a,o=$(t).attr("data-input-ref"),n=$(t).find(".mapping-data__map-to input"),s=n.val();s=void 0===s?void 0:s.trim();var l=$(t).find(".mapping-data__hide-checkbox input").is(":checked");o?(w[f].group[o]={},a=w[f].group[o],a.possible_answers={},a.branch={},a.group={},a.map_to=s,a.hide=l,void 0!==s&&d[r].push(s),s.match(c)||(i=!1,$(t).find(".mapping-data__map-to input").parent().addClass("has-error"))):$(t).find(".mapping-data__possible_answer__map-to input").each(function(e,a){var o=$(t).prev().attr("data-input-ref"),n=w[f].group[o],r=$(a).attr("data-answer-ref"),s=$(a).val();s=void 0===s?void 0:s.trim(),s.match(p)||(i=!1,$(a).parent().addClass("has-error")),n.possible_answers[r]={},n.possible_answers[r].map_to=s})}),u+=_.length}u++}else $(l[u]).find(".mapping-data__possible_answer__map-to input").each(function(e,t){var a=$(l[u-1]).attr("data-input-ref"),o=$(t).attr("data-answer-ref"),n=$(t).val();n=void 0===n?void 0:n.trim(),n.match(p)||(i=!1,$(t).parent().addClass("has-error")),w[a].possible_answers[o]={},w[a].possible_answers[o].map_to=n}),u++}console.log(JSON.stringify(d)),$.each(d,function(e,t){var a=[];$.each(t,function(t,o){return $.inArray(o.trim(),a)!==-1?(s={key:o,formRef:e},i=!1,console.log(o),!1):void a.push(o.trim())})})}),console.log(JSON.stringify(n[a])),i?window.EC5.projectUtils.postRequest(e+"/update",{action:t,map_index:a,mapping:n[a]}).done(function(e){window.EC5.overlay.fadeOut(),window.EC5.toast.showSuccess(o+" updated")}).fail(function(e){window.EC5.overlay.fadeOut(),window.EC5.projectUtils.showErrors(e)}):(s?(l.each(function(e,t){if($(t).data("form-ref")===s.formRef){var a=$(t).find("tbody tr");a.each(function(e,t){$(t).find(".mapping-data__map-to input").val()===s.key&&$(t).find(".mapping-data__map-to").addClass("has-error")})}}),window.EC5.toast.showError(o+" has got duplicate identifier: "+s.key)):window.EC5.toast.showError(o+" has got invalid identifier(s)"),window.EC5.overlay.fadeOut())}}(window.EC5.mapping),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.addUserProjectRole=function(t,a,o,n){var r;$.ajax({url:t,type:"POST",dataType:"json",data:a}).done(function(t){window.EC5.toast.showSuccess(t.data.message),$.when(e.getProjectUsers(o,1)).then(function(e){var t=o.replace("page-","");$(".manage-project-users__"+o).html(e),$(".page-manage-users .nav-tabs li").find("a."+t+"-tab-btn").trigger("click"),n&&n()});
}).fail(function(e){var t="ec5_90";if(e.responseJSON.errors&&e.responseJSON.errors.length>0)for(r=0;r<e.responseJSON.errors.length;r++)e.responseJSON.errors[r].code===t?$("#ec5ModalNewUser").modal():window.EC5.toast.showError(e.responseJSON.errors[r].title)})}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.config={messages:{error:{CSV_FILE_INVALID:"CSV file is invalid",INVALID_EMAILS:"Invalid emails",BROWSER_NOT_SUPPORTED:"Browser not supported"},success:{USERS_IMPORTED:"Users added to the project"},warning:{SOME_USERS_NOT_IMPORTED:"Some users could not be imported"}},consts:{CSV_FILE_EXTENSION:"csv",ANIMATION_FAST:200,ANIMATION_NORMAL:500,ROLES:{CREATOR:"creator",MANAGER:"manager",CURATOR:"curator",COLLECTOR:"collector",VIEWER:"viewer"}},errorCodes:{userDoesntExist:"ec5_90",importerDoesNotHavePermission:"ec5_91",invalidValue:"ec5_29",invalidEmailAddress:"ec5_42",creatorEmailAddress:"ec5_217",managerEmailAddress:"ec5_344"},invalidEmailAddresses:[]}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.exportUsersToCSV=function(e){var t=this,a=t.config,o=new $.Deferred,n=window.EC5.SITE_URL+"/api/internal/project-users/"+e;return $.ajax({url:n,type:"GET",dataType:"json"}).done(function(t){var n={all:[],creators:[],managers:[],curators:[],collectors:[],viewers:[]},r={all:"",creators:"",managers:"",curators:"",collectors:"",viewers:""};$(t.data).each(function(e,t){switch(n.all.push(t),t.role){case"creator":n.creators.push(t);break;case"manager":n.managers.push(t);break;case"curator":n.curators.push(t);break;case"collector":n.collectors.push(t);break;case"viewer":n.viewers.push(t)}}),$.each(n,function(e){r[e]=Papa.unparse({data:n[e]},{quotes:!1,quoteChar:"",delimiter:",",header:!0,newline:"\r\n"})});var i=new JSZip;$.each(r,function(e,t){i.file(e+".csv",t)}),i.generateAsync({type:"blob"}).then(function(t){try{saveAs(t,e+"_users.zip"),o.resolve()}catch(n){console.log(n),o.reject(a.messages.error.BROWSER_NOT_SUPPORTED)}})}).fail(function(e){o.reject(e)}),o.promise()},e.getTotalsByRole=function(e){var t=new $.Deferred,a=window.EC5.SITE_URL+"/api/internal/project-users/"+e;return $.ajax({url:a,type:"GET",dataType:"json"}).done(function(e){var a={creator:0,manager:0,curator:0,collector:0,viewer:0};$(e.data).each(function(e,t){a[t.role]++}),t.resolve(a)}).fail(function(e){t.reject(e)}),t.promise()}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.getProjectUsers=function(e,t,a){var o=new $.Deferred,n={};t="undefined"!=typeof t?t:1,a="undefined"!=typeof a?a:"",n[e]=t,n.search=a;var r=$.ajax({url:"",type:"GET",dataType:"json",data:n}),i=window.EC5.project_users.updateRoleCounters();return $.when(r,i).then(function(e){o.resolve(e[0])}).fail(function(e){o.reject(e[0])}),o.promise()}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){function t(e){var t=/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;return t.test(e)}e.importUsersByEmail=function(e){var a=[],o=e.selectedHeaderIndex,n=e.importedJson,r=n.meta.fields,i=e.doesFirstRowContainsHeaders,s=e.selectedUserRole,d=e.postURL,c=new $.Deferred,p=window.EC5.project_users.config;if(p.invalidEmailAddresses=[],null===o)return!1;if(!i){var l={};l[n.meta.fields[o]]=n.meta.fields[o],n.data.unshift(l)}$(n.data).each(function(e,n){var i=n[r[o]];""!==i.trim()&&(t(i)?a.push(i):p.invalidEmailAddresses.push(i))});var u={role:s,emails:$.unique(a).slice(0,100)};return $.ajax({url:d,type:"POST",dataType:"json",data:u}).done(function(e){c.resolve(e)}).fail(function(e){c.reject(e)}),c.promise()}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.pickCSVFile=function(e){function t(e){var t="";return e.responseJSON?$.each(e.responseJSON.errors,function(e,a){t+=a.title+"<br/>"}):t=e,t}var a,o,n=this,r=e[0],i=n.config;if(window.EC5.overlay.fadeIn(),n.isOpeningFileBrowser=!1,!r)return window.EC5.overlay.fadeOut(i.consts.ANIMATION_FAST),void window.EC5.toast.showError(i.messages.error.CSV_FILE_INVALID);if(a=r.name.split("."),o=a[a.length-1],o!==i.consts.CSV_FILE_EXTENSION)return window.EC5.overlay.fadeOut(i.consts.ANIMATION_FAST),void window.EC5.toast.showError(i.messages.error.CSV_FILE_INVALID);var s=new FileReader;s.onload=function(e){var a=e.target.result,o=Papa.parse(a,{header:!0,delimiter:",",skipEmptyLines:"greedy"}),r=o.meta.fields,s=$("#ec5ModalImportUsers");return 0===o.data.length?(window.EC5.overlay.fadeOut(i.consts.ANIMATION_FAST),void window.EC5.toast.showError(i.messages.error.CSV_FILE_INVALID)):(s.modal(),s.off().on("shown.bs.modal",function(){var e,a,d,c=s.find(".users-column-picker"),p="",l=null,u=s.data("post-url");c.find(".btn").html('Pick column <span class="caret"></span>'),c.find(".btn").val(""),s.find(".users__first-row-headers input").prop("checked",!0),s.find(".users__pick-role input#collector").prop("checked",!0),s.find(".users-perform-import").attr("disabled",!0),window.EC5.overlay.fadeOut(i.consts.ANIMATION_FAST),$(r).each(function(e,t){p+="<li>",p+='<a href="#">'+t.trunc(25)+"</a>",p+="</li>"}),c.find(".dropdown-menu").empty().append(p),c.find(".dropdown-menu li").off().on("click",function(){$(this).parents(".users-column-picker").find(".btn").html($(this).text()+' <span class="caret"></span>'),$(this).parents(".users-column-picker").find(".btn").val($(this).data("value")),l=$(this).index(),s.find(".users-perform-import").attr("disabled",!1)}),$(".users-perform-import").off().on("click",function(){return null!==l&&(window.EC5.overlay.fadeIn(),a=s.find(".users__first-row-headers").find(".checkbox input").is(":checked"),d=s.find(".users__pick-role").find(".radio input:checked").val(),e={doesFirstRowContainsHeaders:a,selectedUserRole:d,importedJson:o,selectedHeaderIndex:l,postURL:u},void window.setTimeout(function(){console.log("imported"),$.when(n.importUsersByEmail(e)).then(function(e){var t="page-"+d;$.when(window.EC5.project_users.getProjectUsers(t,1,"").then(function(e){$(".manage-project-users__"+t).html(e),$(".page-manage-users .nav-tabs li").find("a."+d+"-tab-btn").trigger("click"),window.EC5.overlay.fadeOut(),$("#ec5ModalImportUsers").modal("hide"),i.invalidEmailAddresses.length>0?(window.EC5.toast.showWarning(i.messages.warning.SOME_USERS_NOT_IMPORTED),window.EC5.toast.showError(i.messages.error.INVALID_EMAILS+": <br/>"+i.invalidEmailAddresses.join("<br/>"))):window.EC5.toast.showSuccess(i.messages.success.USERS_IMPORTED)},function(){window.EC5.overlay.fadeOut()}))},function(e){var a="page-"+d;$.when(window.EC5.project_users.getProjectUsers(a,1,"").then(function(o){$(".manage-project-users__"+a).html(o),$(".page-manage-users .nav-tabs li").find("a."+d+"-tab-btn").trigger("click"),window.EC5.overlay.fadeOut(),$("#ec5ModalImportUsers").modal("hide"),window.EC5.toast.showError(t(e)),i.invalidEmailAddresses.length>0&&(window.EC5.toast.showWarning(i.messages.warning.SOME_USERS_NOT_IMPORTED),window.EC5.toast.showError(i.messages.error.INVALID_EMAILS+": <br/>"+i.invalidEmailAddresses.join("<br/>")))},function(){window.EC5.overlay.fadeOut()}))})},1e3))})}),void s.find('button[data-dismiss="modal"]').one("click",function(){s.modal("hide")}))},s.readAsText(r)}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.removeUserProjectRole=function(t,a,o,n,r){var i,s=window.EC5.project_users.config,d=a.length,c={};for(window.EC5.overlay.fadeIn(),i=0;i<d;i++)c[a[i].name]=a[i].value;var p=c["total-users"]-1;0===p&&(n-=1),$.ajax({url:t,type:"POST",dataType:"json",data:a,page:n}).done(function(t){$.when(e.getProjectUsers(o,n,r)).then(function(e){$(".manage-project-users__"+o).html(e),window.setTimeout(function(){window.EC5.toast.showSuccess(t.data.message),window.EC5.overlay.fadeOut()},s.consts.ANIMATION_NORMAL)},function(e){window.setTimeout(function(){if(e.responseJSON.errors&&e.responseJSON.errors.length>0)for(i=0;i<e.responseJSON.errors.length;i++)window.EC5.toast.showError(e.responseJSON.errors[i].title);window.EC5.overlay.fadeOut()},s.consts.ANIMATION_NORMAL)})}).fail(function(e){window.setTimeout(function(){if(e.responseJSON.errors&&e.responseJSON.errors.length>0)for(i=0;i<e.responseJSON.errors.length;i++)window.EC5.toast.showError(e.responseJSON.errors[i].title);window.EC5.overlay.fadeOut()},s.consts.ANIMATION_NORMAL)})}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.removeUsersByRole=function(e,t){var a=new $.Deferred,o=window.EC5.SITE_URL+"/api/internal/project-users/"+e+"/remove-by-role";return $.ajax({url:o,type:"POST",dataType:"json",data:{role:t}}).done(function(e){var o="page-"+t;$(".manage-project-users__"+o).html(""),a.resolve(e)}).fail(function(e){a.reject(e)}),a.promise()}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.switchUserRole=function(e,t,a,o){var n=window.EC5.SITE_URL+"/api/internal/project-users/"+e+"/switch-role",r=window.EC5.project_users.config,i=$.map(r.consts.ROLES,function(e){return e}),s=new $.Deferred;$.inArray(a,i)!==-1&&$.inArray(o,i)!==-1||s.reject("Invalid role!"),a===o&&s.reject("Old role and new role are the same!");var d={email:t,currentRole:a,newRole:o};return $.ajax({url:n,type:"POST",dataType:"json",data:d}).done(function(e){console.log(e),s.resolve(e)}).fail(function(e){console.log(e),s.reject(e)}),s.promise()}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.updateRoleCounters=function(){var e=$(".page-manage-users"),t=new $.Deferred,a=e.data("project-slug"),o={all:e.find(".count-overall"),creator:e.find(".nav-tabs-roles").find(".count-creator"),manager:e.find(".nav-tabs-roles").find(".count-manager"),curator:e.find(".nav-tabs-roles").find(".count-curator"),collector:e.find(".nav-tabs-roles").find(".count-collector"),viewer:e.find(".nav-tabs-roles").find(".count-viewer")},n=0;return $.when(window.EC5.project_users.getTotalsByRole(a)).then(function(e){Object.keys(o).forEach(function(t){o[t].text(e[t]),n+=e[t]||0}),o.all.text(n)}).fail(function(e){t.reject(e)}).always(function(){t.resolve()}),t.promise()}}(window.EC5.project_users);