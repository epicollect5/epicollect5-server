"use strict";window.EC5=window.EC5||{},window.EC5.admin=window.EC5.admin||{},window.EC5.admin.projects=window.EC5.admin.projects||{},function(e){e.updateRole=function(e,t){$.ajax({url:window.EC5.SITE_URL+"/admin/update-user-project-role",type:"POST",dataType:"json",data:{role:e,project_id:t}}).done(function(e){window.EC5.toast.showSuccess(e.data.title)}).fail(window.EC5.showError)},e.getProjects=function(e){var t=new $.Deferred;return console.log(e),$.ajax({url:e.url,type:"GET",dataType:"json",data:e}).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()}}(window.EC5.admin.projects),$(document).ready(function(){function e(){$("table td[data-project-slug]").each(function(){var e=$(this),t=e.data("project-slug");e.find(".spinner").removeClass("hidden").fadeIn(),$.get(window.EC5.SITE_URL+"/api/internal/counters/media/"+t,function(t){var n=t.data.counters.total;e.find(".spinner").addClass("hidden").fadeOut(function(){e.find(".counter-total").text(i(n)).removeClass("hidden").fadeIn()})})})}function t(t){t.preventDefault();var i=f.data("selected-value"),a=l.data("selected-value");o.page=$(t.target).attr("href").split("page=")[1],o.name=d.val().trim(),o.access="any"===a?"":a,o.visibility="any"===i?"":i,n(0),e()}function n(n){_.removeClass("hidden"),w.find(".projects__table__wrapper").empty(),s(function(){window.EC5.admin.projects.getProjects(o).then(function(e){_.addClass("hidden"),w.hide().append(e).fadeIn(500),$(".pagination").on("click","a",t)},function(e){console.log(e)})},n),e()}function i(e,t){if(0===e)return"0 B";var n=1024,i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],a=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,a)).toFixed(t))+" "+i[a]}var a=$(".url").data("js"),r=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},s=function(){var e=0;return function(t,n){clearTimeout(e),e=setTimeout(t,n)}}(),o={url:a,page:1,name:"",access:"",visibility:""},d=$(".page-admin .projects-list__filter-controls .projects-list__project-search"),u=$(" .page-admin .projects-list__filter-controls_dropdowns"),l=u.find(".filter-controls__access .dropdown-toggle"),c=u.find(".filter-controls__access .dropdown-menu"),f=u.find(".filter-controls__visibility .dropdown-toggle"),p=u.find(".filter-controls__visibility .dropdown-menu"),w=$(" .page-admin .projects-list"),_=$(".page-admin .projects-loader");e(),w.on("change",".project-roles",function(){var e=$(this).data("projectId"),t=$(this).val();window.EC5.admin.projects.updateRole(t,e)}),d.keyup(function(){o.name=$(this).val().trim();var e=l.data("selected-value"),t=f.data("selected-value");o.access="any"===e?"":e,o.visibility="any"===t?"":t,n(500)}),c.on("click","li",function(){var e=$(this).data("filter-value");o.access="any"===e?"":e,l.data("selected-value",e),l.parent().find(".dropdown-text").text(r(e)),console.log(o),n(0)}),p.on("click","li",function(){var e=$(this).data("filter-value");o.visibility="any"===e?"":e,f.data("selected-value",e),f.parent().find(".dropdown-text").text(r(e)),n(0)}),$(".pagination").on("click","a",t)}),$(document).ready(function(){function e(e,t){var n=new $.Deferred;window.EC5.overlay.fadeIn();var i=window.EC5.SITE_URL+"/api/internal/admin/settings";return $.ajax({url:i,type:"POST",data:{key:e,value:t}}).done(function(e){console.log(e),window.EC5.toast.showSuccess("Settings updated successfully."),n.resolve(e)}).fail(function(e){if(e.responseJSON.errors&&e.responseJSON.errors.length>0)for(var t=0;t<e.responseJSON.errors.length;t++)window.EC5.toast.showError(e.responseJSON.errors[t].title);n.reject(e)}).always(function(){window.EC5.overlay.fadeOut()}),n.promise()}$("[data-setting-type]").on("click",function(){var t=$(this).data("setting-type");switch(console.log("Setting type clicked:",t),t){case"email-notification-version":var n=$(this).data("value");console.log("Setting type value clicked:",n),e("SEND_VERSION_NOTIFICATION_EMAIL","on"===n).then(function(){$(this).siblings().removeClass("btn-action"),$(this).addClass("btn-action")},function(e){})}})}),window.EC5=window.EC5||{},window.EC5.users=window.EC5.users||{},function(e){e.showError=function(e){if(e.responseJSON.errors&&e.responseJSON.errors.length>0){var t;for(t=0;t<e.responseJSON.errors.length;t++)window.EC5.toast.showError(e.responseJSON.errors[t].title)}},e.getUsers=function(t,n,i,a){window.setTimeout(function(){window.EC5.overlay.fadeIn()},500),$(".user-administration__users").find(".user-administration__table").animate({opacity:0},500),t="undefined"!=typeof t?t:1,n="undefined"!=typeof n?n:"",i="undefined"!=typeof i?i:"",a="undefined"!=typeof a?a:"",$.ajax({url:window.EC5.SITE_URL+"/admin/users",type:"GET",dataType:"json",data:{page:t,search:n,server_role:i,state:a}}).done(function(e){$(".user-administration__users").html(e).animate({opacity:1},500)}).fail(e.showError).always(function(){window.EC5.overlay.fadeOut()})},e.updateUser=function(t,n){$.ajax({url:t,type:"POST",dataType:"json",data:n}).done(function(){var t=$(".user-administration"),n=t.find(".user-administration__user-search").val(),i=t.find(".user-administration__user-filter__server-role").val(),a=t.find(".user-administration__user-filter__state").val(),r=t.find(".pagination .active span").html();e.getUsers(r,n,i,a)}).fail(e.showError)},e.addUser=function(t,n,i){$.ajax({url:t,type:"POST",dataType:"json",data:n}).done(function(){window.EC5.toast.showSuccess("New User added."),e.getUsers(),i&&i()}).fail(e.showError)}}(window.EC5.users),$(document).ready(function(){var e=$(".user-administration"),t=$("#ec5ModalAddUser");e.on("click",".pagination a",function(e){e.preventDefault();var t=$(this).closest(".user-administration"),n=t.find(".user-administration__user-search").val(),i=t.find(".user-administration__user-filter-option").val();window.EC5.users.getUsers($(this).attr("href").split("page=")[1],n,"server_role",i),window.scrollTo(0,0)});var n;e.on("keyup",".user-administration__user-search",function(e){var t=this.value;if(t.length>=3||13===e.keyCode){var i=$(this).closest(".user-administration"),a=i.find(".user-administration__user-filter__server_role").val(),r=i.find(".user-administration__user-filter__state").val(),s=200;clearTimeout(n),n=setTimeout(function(){window.EC5.users.getUsers(1,t,a,r)},s)}}),e.on("change",".user-administration__user-filter__state",function(e){var t=$(".user-administration__user-search").val(),n=$(".user-administration__user-filter__server-role").val();window.EC5.users.getUsers(1,t,n,this.value)}),e.on("change",".user-administration__user-filter__server-role",function(e){var t=$(".user-administration__user-search").val(),n=$(".user-administration__user-filter__state").val();window.EC5.users.getUsers(1,t,this.value,n)}),e.on("click",".user-administration__user-clear",function(e){e.preventDefault(),$(".user-administration__user-search").val(""),$(".user-administration__user-filter__server-role").val(""),$(".user-administration__user-filter__state").val(""),window.EC5.users.getUsers()}),e.on("submit",".user-administration__table__state-form",function(e){e.preventDefault();var t=$(this).serialize(),n=$(this).attr("action");window.EC5.users.updateUser(n,t)}),e.on("submit",".user-administration__table__server-role-form",function(e){e.preventDefault();var t=$(this).serialize(),n=$(this).attr("action");window.EC5.users.updateUser(n,t)}),$(".manage-users__user-add-form").on("submit",function(e){e.preventDefault();var t=$(this).serialize(),n=$(this).attr("action");window.EC5.users.addUser(n,t,function(){$("#ec5ModalAddUser").modal("hide")})}),t.find(".show-password-control").on("click",function(){$(this).prop("checked")?t.find("input.password-input").each(function(){$(this).attr("type","text")}):t.find("input.password-input").each(function(){$(this).attr("type","password")})})});