"use strict";window.EC5=window.EC5||{},window.EC5.admin=window.EC5.admin||{},window.EC5.admin.projects=window.EC5.admin.projects||{},function(e){e.updateRole=function(e,t){$.ajax({url:window.EC5.SITE_URL+"/admin/update-user-project-role",type:"POST",dataType:"json",data:{role:e,project_id:t}}).done(function(e){window.EC5.toast.showSuccess(e.data.title)}).fail(window.EC5.showError)},e.getProjects=function(e){var t=new $.Deferred;return console.log(e),$.ajax({url:e.url,type:"GET",dataType:"json",data:e}).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()}}(window.EC5.admin.projects),$(document).ready(function(){function e(e){e.preventDefault();var n=u.data("selected-value"),i=d.data("selected-value");a.page=$(e.target).attr("href").split("page=")[1],a.name=s.val().trim(),a.access="any"===i?"":i,a.visibility="any"===n?"":n,t(0)}function t(t){w.removeClass("hidden"),_.find(".projects__table__wrapper").empty(),r(function(){window.EC5.admin.projects.getProjects(a).then(function(t){w.addClass("hidden"),_.hide().append(t).fadeIn(500),$(".pagination").on("click","a",e)},function(e){console.log(e)})},t)}var n=$(".url").data("js"),i=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},r=function(){var e=0;return function(t,n){clearTimeout(e),e=setTimeout(t,n)}}(),a={url:n,page:1,name:"",access:"",visibility:"",order_by:"entries"},s=$(".page-admin .projects-list__filter-controls .projects-list__project-search"),o=$(" .page-admin .projects-list__filter-controls_dropdowns"),d=o.find(".filter-controls__access .dropdown-toggle"),l=o.find(".filter-controls__access .dropdown-menu"),u=o.find(".filter-controls__visibility .dropdown-toggle"),c=o.find(".filter-controls__visibility .dropdown-menu"),f=o.find(".filter-controls__order_by .dropdown-toggle"),p=o.find(".filter-controls__order_by .dropdown-menu"),_=$(" .page-admin .projects-list"),w=$(".page-admin .projects-loader");_.on("change",".project-roles",function(){var e=$(this).data("projectId"),t=$(this).val();window.EC5.admin.projects.updateRole(t,e)}),s.keyup(function(){a.name=$(this).val().trim();var e=d.data("selected-value"),n=u.data("selected-value");a.access="any"===e?"":e,a.visibility="any"===n?"":n,t(500)}),l.on("click","li",function(){var e=$(this).data("filter-value");a.access="any"===e?"":e,d.data("selected-value",e),d.parent().find(".dropdown-text").text(i(e)),console.log(a),t(0)}),p.on("click","li",function(){var e=$(this).data("filter-value");a.order_by=e,f.data("selected-value",e),f.parent().find(".dropdown-text").text(i(e)),console.log(a),t(0)}),c.on("click","li",function(){var e=$(this).data("filter-value");a.visibility="any"===e?"":e,u.data("selected-value",e),u.parent().find(".dropdown-text").text(i(e)),t(0)}),$(".pagination").on("click","a",e)}),$(document).ready(function(){function e(e,t){var n=new $.Deferred;window.EC5.overlay.fadeIn();var i=window.EC5.SITE_URL+"/api/internal/admin/settings";return $.ajax({url:i,type:"POST",data:{key:e,value:t}}).done(function(e){console.log(e),window.EC5.toast.showSuccess("Settings updated successfully."),n.resolve(e)}).fail(function(e){if(e.responseJSON.errors&&e.responseJSON.errors.length>0)for(var t=0;t<e.responseJSON.errors.length;t++)window.EC5.toast.showError(e.responseJSON.errors[t].title);n.reject(e)}).always(function(){window.EC5.overlay.fadeOut()}),n.promise()}$("[data-setting-type]").on("click",function(){var t=$(this).data("setting-type");switch(console.log("Setting type clicked:",t),t){case"email-notification-version":var n=$(this).data("value");console.log("Setting type value clicked:",n),e("SEND_VERSION_NOTIFICATION_EMAIL","on"===n).then(function(){$(this).siblings().removeClass("btn-action"),$(this).addClass("btn-action")},function(e){})}})}),window.EC5=window.EC5||{},window.EC5.users=window.EC5.users||{},function(e){e.showError=function(e){if(e.responseJSON.errors&&e.responseJSON.errors.length>0){var t;for(t=0;t<e.responseJSON.errors.length;t++)window.EC5.toast.showError(e.responseJSON.errors[t].title)}},e.getUsers=function(t,n,i,r){window.setTimeout(function(){window.EC5.overlay.fadeIn()},500),$(".user-administration__users").find(".user-administration__table").animate({opacity:0},500),t="undefined"!=typeof t?t:1,n="undefined"!=typeof n?n:"",i="undefined"!=typeof i?i:"",r="undefined"!=typeof r?r:"",$.ajax({url:window.EC5.SITE_URL+"/admin/users",type:"GET",dataType:"json",data:{page:t,search:n,server_role:i,state:r}}).done(function(e){$(".user-administration__users").html(e).animate({opacity:1},500)}).fail(e.showError).always(function(){window.EC5.overlay.fadeOut()})},e.updateUser=function(t,n){$.ajax({url:t,type:"POST",dataType:"json",data:n}).done(function(){var t=$(".user-administration"),n=t.find(".user-administration__user-search").val(),i=t.find(".user-administration__user-filter__server-role").val(),r=t.find(".user-administration__user-filter__state").val(),a=t.find(".pagination .active span").html();e.getUsers(a,n,i,r)}).fail(e.showError)},e.addUser=function(t,n,i){$.ajax({url:t,type:"POST",dataType:"json",data:n}).done(function(){window.EC5.toast.showSuccess("New User added."),e.getUsers(),i&&i()}).fail(e.showError)}}(window.EC5.users),$(document).ready(function(){var e=$(".user-administration"),t=$("#ec5ModalAddUser");e.on("click",".pagination a",function(e){e.preventDefault();var t=$(this).closest(".user-administration"),n=t.find(".user-administration__user-search").val(),i=t.find(".user-administration__user-filter-option").val();window.EC5.users.getUsers($(this).attr("href").split("page=")[1],n,"server_role",i),window.scrollTo(0,0)});var n;e.on("keyup",".user-administration__user-search",function(e){var t=this.value;if(t.length>=3||13===e.keyCode){var i=$(this).closest(".user-administration"),r=i.find(".user-administration__user-filter__server_role").val(),a=i.find(".user-administration__user-filter__state").val(),s=200;clearTimeout(n),n=setTimeout(function(){window.EC5.users.getUsers(1,t,r,a)},s)}}),e.on("change",".user-administration__user-filter__state",function(e){var t=$(".user-administration__user-search").val(),n=$(".user-administration__user-filter__server-role").val();window.EC5.users.getUsers(1,t,n,this.value)}),e.on("change",".user-administration__user-filter__server-role",function(e){var t=$(".user-administration__user-search").val(),n=$(".user-administration__user-filter__state").val();window.EC5.users.getUsers(1,t,this.value,n)}),e.on("click",".user-administration__user-clear",function(e){e.preventDefault(),$(".user-administration__user-search").val(""),$(".user-administration__user-filter__server-role").val(""),$(".user-administration__user-filter__state").val(""),window.EC5.users.getUsers()}),e.on("submit",".user-administration__table__state-form",function(e){e.preventDefault();var t=$(this).serialize(),n=$(this).attr("action");window.EC5.users.updateUser(n,t)}),e.on("submit",".user-administration__table__server-role-form",function(e){e.preventDefault();var t=$(this).serialize(),n=$(this).attr("action");window.EC5.users.updateUser(n,t)}),$(".manage-users__user-add-form").on("submit",function(e){e.preventDefault();var t=$(this).serialize(),n=$(this).attr("action");window.EC5.users.addUser(n,t,function(){$("#ec5ModalAddUser").modal("hide")})}),t.find(".show-password-control").on("click",function(){$(this).prop("checked")?t.find("input.password-input").each(function(){$(this).attr("type","text")}):t.find("input.password-input").each(function(){$(this).attr("type","password")})})});